显然只有 $\le \sqrt{M}$ 也就是 $\le 447$ 的质数会贡献超过 $1$ 次，所以对这 $86$ 个质数建立 $86$ 个 ST 表，每次查询 RMQ 就好了。（如果卡空间：注意到指数不会很大，所以 ST 表可以开成 `char`）

对于剩下的所有质数，指数只能是 0 / 1，我们首先把每个 $a_i$ 都变为这个最大的质因子（如果没有超过 $\sqrt{M}$ 就设为 $1$），假设不强制在线，那么容易得到一个扫描线的做法：扫描 $r$，每次在线段树上把 $lst_{a_r}$ 位置的值改成 $1$，把当前位置设为 $a_i$，询问就是查询 $[l, r]$ 的区间乘积。显然强制在线只需把上述操作放到主席树上即可。

总复杂度是 $O(n \pi(\sqrt{M}) \log n)$，瓶颈是处理 $86$ 个 ST 表。

