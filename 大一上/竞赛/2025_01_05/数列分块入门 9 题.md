数列分块 9 题：

- 1 4 5 7 没有做的必要。6 是块状链表模板，9 是典题。
- 2：区间加，查询区间内 $x$ 的排名。对于整块直接记录 tag，对于散块考虑暴力重新排序，此处复杂度为 $O(B \log B)$；注意到修改前块内是有序的，所以把未修改的和进行修改的元素拿出来归并即可完成排序，所以复杂度变为 $O(B)$。查询则进行 $O(\dfrac{n}{B})$ 次二分，复杂度为 $O(\dfrac{n}{B} \log B)$，平衡复杂度后为 $O(n \sqrt{n \log n})$。
- 3：区间加，查询区间内 $x$ 的前驱。类比 2 即可。
- 8：我们考虑每个块内的颜色数。跨过这个块的询问会使颜色数变为 $1$，假设此时块内颜色数不为 $1$，则直接 $O(B)$ 暴力重构整个块并求答案（对于颜色数已经为 $1$ 的询问只需要判断 tag 是否为 $c$）；在这个块内的询问会使颜色数 $+1$，此时也 $O(B)$ 暴力重构并求答案，注意到这只会使这一块的颜色数上升，所以只会再贡献至多 $O(B)$ 的暴力重构。一开始每个块有至多 $O(B)$ 的重构开销，此后每个询问至多带来 $O(B)$ 的开销，所以重构的总开销是 $O((n + q)B)$ 的，最后复杂度就是 $O(n \sqrt{n})$。