考虑对 $k$ 进行根号分治，显然 $k \ge \sqrt{n}$ 时暴力回答询问即可，单次复杂度 $O(\sqrt{n})$ ；对于 $k \lt \sqrt{n}$ 的情况，枚举 $k$ ，由于我们可以从 $p+a_p+k$ 的步数推知 $p$ 的步数，所以从后往前递推即可，这部分复杂度 $O(n \sqrt{n})$ ， 可以 $O(1)$ 回答询问。总复杂度是 $O((n + q) \sqrt{n})$。