题意：维护一个序列，支持以下三种操作：1. 区间内所有颜色为 $x$ 的数颜色改为 $y$；2. 区间内所有颜色为 $x$ 的数加上 $d$；3. 查询区间和。$n, q \le 2.5 \times 10^5$，$\text{6s, 1GB}$。



考虑并查集，将块内的同种颜色合并到一起，当块内两种颜色都存在时，合并操作一定会导致颜色数减少 $1$，由于题目中不存在使块内颜色数增加的操作，初始时一个块内颜色数为 $O(B)$，则其至多被合并操作影响 $O(B)$ 次，于是每次暴力重构整个块即可（对于每个并查集只需要维护根的颜色就可以了）。注意到我们只会在重构块时进行每个数的颜色查询，所以所有重构操作的总复杂度是 $O(n \alpha(n) + nB)$ 的，而查询是 $O(\dfrac{n}{B})$ 的，所以取 $B = \sqrt{n}$，复杂度即 $O(n \sqrt{n})$。