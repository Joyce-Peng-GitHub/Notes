设 $f_{i}$ 表示从 $i$ 出发，能跳到的第一个不同块的位置。

这样一次查询只需要暴力跳就好了。

修改就是先改 $f_i$，再对于能跳到 $i$ 的所有同块的位置 $j$ 修改一下 $f_j$ 为新的 $f_i$，而判断能不能跳到只需要从 $i$ 开始倒着枚举到左端点，中途用个数组记录一下每个位置能不能跳到就好了。

显然这个方法也是可以维护步数的，所以就做完了。复杂度是 $O(n \sqrt{n})$。