考虑对 $p$ 根号分治。由于 $ans = \sum_\limits{k = 1}^{\lfloor \dfrac{n}{p} \rfloor} a_{kp + x}$，当 $p \ge \sqrt{n}$ 的时候，我们暴力跳的复杂度是单次 $O(\sqrt{n})$。
考虑 $p \lt \sqrt{n}$ 的情况。我们可以记 $res_{p, x}$ 表示模 $p$ 余 $x$ 的答案，枚举 $p$，对每个 $p$ 可以 $O(n)$ 复杂度求出，修改时只需暴力修改每个 $res_{p, i \bmod p}$ 即可。