由于要维护的信息不满足结合律，所以考虑预处理出块间答案 $val_{i, j}$ 和 $cnt_{i, j}$ 表示 $i \sim j$ 块内的最小众数及其出现次数。考虑散块的贡献：至多有 $2B - 2$ 个散点，那么最终的众数出现次数最多会增加 $2B - 2$。设询问区间为 $[L, R]$，当前的答案为 $val, cnt$，对左边的每个散点 $i$，其能成为新的答案当且仅当 $a_i$ 在 $[i, R]$ 中的出现次数 $\gt cnt$。由于出现次数不好数，我们考虑找充要条件，不难发现这等价于 $[i + 1, n]$ 中第 $cnt$ 个 $a_i$ 值出现的位置 $\le R$，于是我们只需对每个值维护一个下标序列即可快速判断这一点。对于右侧的散点同理。注意到每次 $val$ 改变时 $cnt$ 只会 $+1$，于是就做完了。复杂度为 $O(n \sqrt{n})$。